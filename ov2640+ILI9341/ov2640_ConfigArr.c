#include "stm32f4xx_hal.h"

/*设置RGB565格式输出
 */
const uint8_t ov2640_Set_RGB565_Config[14][2] = {
    {0xFF, 0x00},
    {0xDA, 0x08},
    {0xD7, 0x03},
    {0xDF, 0x02},
    {0x33, 0xA0},
    {0x3C, 0x00},
    {0xE1, 0x67},
    {0xFF, 0x01},
    {0xE0, 0x00},
    {0xE1, 0x00},
    {0xE5, 0x00},
    {0xD7, 0x00},
    {0xDA, 0x00},
    {0xE0, 0x00},
};


// OV2640 配置：MCLK=24MHz, SVGA(800x600) RGB565 25fps
const uint8_t ov2640_SVGA_RGB565_25fps_Config[212][2] = {
    // 基础准备：Bank切换与软复位
    {0xFF, 0x01},    // 切换到Bank 1寄存器组
    {0x12, 0x80},    // 系统软复位（清除旧状态）
    {0xFF, 0x00},    // 切换回Bank 0寄存器组
    {0x2C, 0xFF},    // 图像控制相关寄存器初始化
    {0x2E, 0xDF},    // 时序辅助配置
    {0xFF, 0x01},    // 再次切换到Bank 1
    {0x3C, 0x32},    // 输出窗口控制
    
    // 分辨率与时钟基础配置
    {0x11, 0x00},    // 时钟模式控制
    {0x09, 0x02},    // 电源与模块使能
    {0x04, 0x28},    // 时钟分频基础参数
    {0x13, 0xE5},    // 水平有效像素（SVGA宽度相关）
    {0x14, 0x48},    // 垂直有效像素（SVGA高度相关）
    {0x2C, 0x0C},    // 图像格式辅助配置
    {0x33, 0x78},    // 格式过渡配置（为RGB565做准备）
    {0x3A, 0x33},    // 色度信号控制
    {0x3B, 0xFB},    // 亮度信号控制
    
    // 帧率与输出控制
    {0x3E, 0x00},    // 帧率辅助控制
    {0x43, 0x11},    // 像素输出时序校准
    {0x16, 0x10},    // 同步信号极性配置
    
    // 画质优化：白平衡与色彩校准
    {0x39, 0x92},    // 白平衡基础校准
    {0x35, 0xDA},    // 色彩增益控制
    {0x22, 0x1A},    // 对比度参数
    {0x37, 0xC3},    // 色调调节
    {0x23, 0x00},    // 亮度基础配置
    {0x34, 0xC0},    // 白平衡偏移校准
    {0x36, 0x1A},    // 色彩平衡辅助
    {0x06, 0x88},    // 图像锐度控制
    {0x07, 0xC0},    // 降噪参数
    {0x0D, 0x87},    // 自动曝光辅助
    {0x0E, 0x41},    // 增益控制
    {0x4C, 0x00},    // 特殊效果关闭（默认正常图像）
    {0x48, 0x00},    // 黑电平校准
    {0x5B, 0x00},    // 色彩矩阵辅助
    {0x42, 0x03},    // 输出数据格式辅助
    
    // 电源与模块稳定配置
    {0x4A, 0x81},    // 电源模块校准
    {0x21, 0x99},    // 时序稳定性控制
    
    // 同步信号与窗口校准
    {0x24, 0x40},    // 水平同步间隔
    {0x25, 0x38},    // 垂直同步间隔
    {0x26, 0x82},    // 同步信号宽度
    {0x5C, 0x00},    // 窗口偏移校准
    {0x63, 0x00},    // 数据输出延迟
    {0x46, 0x22},    // 像素时钟同步
    {0x0C, 0x3C},    // 时钟相位校准
    
    // 时钟与频率校准
    {0x61, 0x70},    // 主时钟分频辅助
    {0x62, 0x80},    // 频率稳定性控制
    {0x7C, 0x05},    // 时钟校准参数
    
    // 图像增强与输出控制
    {0x20, 0x80},    // 图像边缘增强
    {0x28, 0x30},    // 对比度增强
    {0x6C, 0x00},    // 色彩空间转换辅助
    {0x6D, 0x80},    // 输出格式过渡
    {0x6E, 0x00},    // 数据对齐控制
    {0x70, 0x02},    // 画质优化开关
    {0x71, 0x94},    // 色调微调
    {0x73, 0xC1},    // 色彩饱和度控制
    
    // 分辨率与格式锁定（核心：RGB565）
    {0x12, 0x40},    // 软复位后恢复系统控制
    {0x17, 0x11},    // 行像素数锁定（SVGA）
    {0x18, 0x43},    // 场像素数锁定（SVGA）
    {0x19, 0x00},    // 扫描模式（逐行）
    {0x1A, 0x4B},    // 时序参数微调
    {0x32, 0x09},    // 输出数据同步
    {0x37, 0xC0},    // 色彩校准重置（适配RGB565）
    {0x4F, 0xCA},    // 白平衡精准校准
    {0x50, 0xA8},    // 亮度范围锁定
    {0x5A, 0x23},    // 色度范围锁定
    {0x6D, 0x00},    // 输出格式确认
    {0x3D, 0x38},    // 数据输出驱动能力
    
    // Bank 0 基础参数复位
    {0xFF, 0x00},    // 切换回Bank 0
    {0xE5, 0x7F},    // 图像增强寄存器
    {0xF9, 0xC0},    // 电源管理辅助
    {0x41, 0x24},    // 增益控制确认
    {0xE0, 0x14},    // 画质优化参数
    {0x76, 0xFF},    // 功能使能
    {0x33, 0xA0},    // 核心：设置输出格式为RGB565（关键配置）
    {0x42, 0x20},    // 输出数据极性
    {0x43, 0x18},    // 像素时钟确认
    {0x4C, 0x00},    // 特殊效果关闭（二次确认）
    {0x87, 0xD5},    // 时序延迟校准
    {0x88, 0x3F},    // 数据采样相位
    {0xD7, 0x03},    // 像素时钟分频（匹配24MHz MCLK+SVGA）
    {0xD9, 0x10},    // 同步信号驱动
    {0xD3, 0x82},    // 场周期锁定（25fps）
    
    // 数据传输与驱动配置
    {0xC8, 0x08},    // 数据输出缓冲
    {0xC9, 0x80},    // 驱动能力校准
    
    // 时钟与频率精准校准
    {0x7C, 0x00},    // 时钟校准模式
    {0x7D, 0x00},    // 校准参数1
    {0x7C, 0x03},    // 时钟校准模式切换
    {0x7D, 0x48},    // 校准参数2（第一次写入）
    {0x7D, 0x48},    // 校准参数2（第二次写入，确保生效）
    {0x7C, 0x08},    // 时钟校准模式切换
    {0x7D, 0x20},    // 校准参数3（第一次写入）
    {0x7D, 0x10},    // 校准参数4（第一次写入）
    {0x7D, 0x0E},    // 校准参数5（第一次写入）
    
    // 白平衡曲线校准（多次写入以覆盖不同亮度）
    {0x90, 0x00},    // 白平衡校准模式
    {0x91, 0x0E},    // 白平衡参数1
    {0x91, 0x1A},    // 白平衡参数2
    {0x91, 0x31},    // 白平衡参数3
    {0x91, 0x5A},    // 白平衡参数4
    {0x91, 0x69},    // 白平衡参数5
    {0x91, 0x75},    // 白平衡参数6
    {0x91, 0x7E},    // 白平衡参数7
    {0x91, 0x88},    // 白平衡参数8
    {0x91, 0x8F},    // 白平衡参数9
    {0x91, 0x96},    // 白平衡参数10
    {0x91, 0xA3},    // 白平衡参数11
    {0x91, 0xAF},    // 白平衡参数12
    {0x91, 0xC4},    // 白平衡参数13
    {0x91, 0xD7},    // 白平衡参数14
    {0x91, 0xE8},    // 白平衡参数15
    {0x91, 0x20},    // 白平衡参数16（收尾）
    
    // 色彩增益曲线校准
    {0x92, 0x00},    // 色彩增益校准模式
    {0x93, 0x06},    // 色彩增益参数1
    {0x93, 0xE3},    // 色彩增益参数2
    {0x93, 0x05},    // 色彩增益参数3
    {0x93, 0x05},    // 色彩增益参数4
    {0x93, 0x00},    // 色彩增益参数5
    {0x93, 0x04},    // 色彩增益参数6
    {0x93, 0x00},    // 色彩增益参数7
    {0x93, 0x00},    // 色彩增益参数8
    {0x93, 0x00},    // 色彩增益参数9
    {0x93, 0x00},    // 色彩增益参数10
    {0x93, 0x00},    // 色彩增益参数11
    {0x93, 0x00},    // 色彩增益参数12
    {0x93, 0x00},    // 色彩增益参数13（收尾）
    
    // 亮度曲线校准
    {0x96, 0x00},    // 亮度校准模式
    {0x97, 0x08},    // 亮度参数1
    {0x97, 0x19},    // 亮度参数2
    {0x97, 0x02},    // 亮度参数3
    {0x97, 0x0C},    // 亮度参数4
    {0x97, 0x24},    // 亮度参数5
    {0x97, 0x30},    // 亮度参数6
    {0x97, 0x28},    // 亮度参数7
    {0x97, 0x26},    // 亮度参数8
    {0x97, 0x02},    // 亮度参数9
    {0x97, 0x98},    // 亮度参数10
    {0x97, 0x80},    // 亮度参数11
    {0x97, 0x00},    // 亮度参数12
    {0x97, 0x00},    // 亮度参数13（收尾）
    
    // 色彩与对比度最终校准
    {0xC3, 0xED},    // 色彩矩阵校准
    {0xA4, 0x00},    // 黑电平补偿
    {0xA8, 0x00},    // 白电平补偿
    {0xC5, 0x11},    // 对比度校准
    {0xC6, 0x51},    // 亮度校准
    {0xBF, 0x80},    // 色彩空间控制
    {0xC7, 0x10},    // 色调校准
    {0xB6, 0x66},    // 红色增益
    {0xB8, 0xA5},    // 绿色增益
    {0xB7, 0x64},    // 蓝色增益
    {0xB9, 0x7C},    // 青色增益
    {0xB3, 0xAF},    // 品红增益
    {0xB4, 0x97},    // 黄色增益
    {0xB5, 0xFF},    // 色彩增益范围
    {0xB0, 0xC5},    // 红通道校准
    {0xB1, 0x94},    // 绿通道校准
    {0xB2, 0x0F},    // 蓝通道校准
    {0xC4, 0x5C},    // 色彩平衡最终确认
    
    // SVGA分辨率窗口锁定
    {0xC0, 0x64},    // 水平窗口起始
    {0xC1, 0x4B},    // 水平窗口结束
    {0x8C, 0x00},    // 窗口偏移补偿
    {0x86, 0x3D},    // 数据采样校准
    {0x50, 0x00},    // 垂直窗口起始（低位）
    {0x51, 0xC8},    // 垂直窗口起始（高位）
    {0x52, 0x96},    // 垂直窗口结束（高位）
    {0x53, 0x00},    // 垂直窗口结束（低位）
    {0x54, 0x00},    // 窗口控制辅助
    {0x55, 0x00},    // 窗口控制辅助
    {0x5A, 0xC8},    // 垂直窗口校准（高位）
    {0x5B, 0x96},    // 垂直窗口校准（低位）
    {0x5C, 0x00},    // 窗口校准辅助
    {0xD3, 0x82},    // 场周期最终锁定（确保25fps）
    
    // 电源与功能收尾
    {0xC3, 0xED},    // 色彩矩阵二次确认
    {0x7F, 0x00},    // 功能寄存器复位
    {0xDA, 0x08},    // 同步时序最终校准（匹配SVGA）
    {0xE5, 0x1F},    // 图像增强最终参数
    {0xE1, 0x67},    // 画质优化收尾
    {0xE0, 0x00},    // 图像增强复位（避免过度增强）
    {0xDD, 0x7F},    // 时序稳定性收尾
    {0x05, 0x00}     // 系统控制最终确认（结束标志）
};

/* ov2640 UXGA寄存器配置
 * 该模式下帧率为15FPS
 * UXGA: 1600*1200
 */
const uint8_t ov2640_Init_UXGA_Config[178][2] = {
    {0xFF, 0x00},
    {0x2C, 0xFF},
    {0x2E, 0xDF},
    {0xFF, 0x01},
    {0x3C, 0x32},
    {0x11, 0x00},
    {0x09, 0x02},
    {0x04, 0xA8},
    {0x13, 0xE5},
    {0x14, 0x48},
    {0x2C, 0x0C},
    {0x33, 0x78},
    {0x3A, 0x33},
    {0x3B, 0xFB},
    {0x3E, 0x00},
    {0x43, 0x11},
    {0x16, 0x10},
    {0x39, 0x92},
    {0x35, 0xDA},
    {0x22, 0x1A},
    {0x37, 0xC3},
    {0x23, 0x00},
    {0x34, 0xC0},
    {0x36, 0x1A},
    {0x06, 0x88},
    {0x07, 0xC0},
    {0x0D, 0x87},
    {0x0E, 0x41},
    {0x4C, 0x00},
    {0x48, 0x00},
    {0x5B, 0x00},
    {0x42, 0x03},
    {0x4A, 0x81},
    {0x21, 0x99},
    {0x24, 0x40},
    {0x25, 0x38},
    {0x26, 0x82},
    {0x5C, 0x00},
    {0x63, 0x00},
    {0x46, 0x00},
    {0x0C, 0x3C},
    {0x61, 0x70},
    {0x62, 0x80},
    {0x7C, 0x05},
    {0x20, 0x80},
    {0x28, 0x30},
    {0x6C, 0x00},
    {0x6D, 0x80},
    {0x6E, 0x00},
    {0x70, 0x02},
    {0x71, 0x94},
    {0x73, 0xC1},
    {0x3D, 0x34},
    {0x5A, 0x57},
    {0x12, 0x00},
    {0x17, 0x11},
    {0x18, 0x75},
    {0x19, 0x01},
    {0x1A, 0x97},
    {0x32, 0x36},
    {0x03, 0x0F},
    {0x37, 0x40},
    {0x4F, 0xCA},
    {0x50, 0xA8},
    {0x5A, 0x23},
    {0x6D, 0x00},
    {0x6D, 0x38},
    {0xFF, 0x00},
    {0xE5, 0x7F},
    {0xF9, 0xC0},
    {0x41, 0x24},
    {0xE0, 0x14},
    {0x76, 0xFF},
    {0x33, 0xA0},
    {0x42, 0x20},
    {0x43, 0x18},
    {0x4C, 0x00},
    {0x87, 0xD5},
    {0x88, 0x3F},
    {0xD7, 0x03},
    {0xD9, 0x10},
    {0xD3, 0x82},
    {0xC8, 0x08},
    {0xC9, 0x80},
    {0x7C, 0x00},
    {0x7D, 0x00},
    {0x7C, 0x03},
    {0x7D, 0x48},
    {0x7D, 0x48},
    {0x7C, 0x08},
    {0x7D, 0x20},
    {0x7D, 0x10},
    {0x7D, 0x0E},
    {0x90, 0x00},
    {0x91, 0x0E},
    {0x91, 0x1A},
    {0x91, 0x31},
    {0x91, 0x5A},
    {0x91, 0x69},
    {0x91, 0x75},
    {0x91, 0x7E},
    {0x91, 0x88},
    {0x91, 0x8F},
    {0x91, 0x96},
    {0x91, 0xA3},
    {0x91, 0xAF},
    {0x91, 0xC4},
    {0x91, 0xD7},
    {0x91, 0xE8},
    {0x91, 0x20},
    {0x92, 0x00},
    {0x93, 0x06},
    {0x93, 0xE3},
    {0x93, 0x05},
    {0x93, 0x05},
    {0x93, 0x00},
    {0x93, 0x04},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x93, 0x00},
    {0x96, 0x00},
    {0x97, 0x08},
    {0x97, 0x19},
    {0x97, 0x02},
    {0x97, 0x0C},
    {0x97, 0x24},
    {0x97, 0x30},
    {0x97, 0x28},
    {0x97, 0x26},
    {0x97, 0x02},
    {0x97, 0x98},
    {0x97, 0x80},
    {0x97, 0x00},
    {0x97, 0x00},
    {0xC3, 0xEF},
    {0xA4, 0x00},
    {0xA8, 0x00},
    {0xC5, 0x11},
    {0xC6, 0x51},
    {0xBF, 0x80},
    {0xC7, 0x10},
    {0xB6, 0x66},
    {0xB8, 0xA5},
    {0xB7, 0x64},
    {0xB9, 0x7C},
    {0xB3, 0xAF},
    {0xB4, 0x97},
    {0xB5, 0xFF},
    {0xB0, 0xC5},
    {0xB1, 0x94},
    {0xB2, 0x0F},
    {0xC4, 0x5C},
    {0xC0, 0xC8},
    {0xC1, 0x96},
    {0x8C, 0x00},
    {0x86, 0x3D},
    {0x50, 0x00},
    {0x51, 0x90},
    {0x52, 0x2C},
    {0x53, 0x00},
    {0x54, 0x00},
    {0x55, 0x88},
    {0x5A, 0x90},
    {0x5B, 0x2C},
    {0x5C, 0x05},
    {0xD3, 0x02},
    {0xC3, 0xED},
    {0x7F, 0x00},
    {0xDA, 0x09},
    {0xE5, 0x1F},
    {0xE1, 0x67},
    {0xE0, 0x00},
    {0xDD, 0x7F},
    {0x05, 0x00},
};